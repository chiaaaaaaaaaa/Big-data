---
title: "Brazil"
author: "Juan Gustavo Prestes Calani (1071203), Elena Rocco (1068161), Chiara Baviera (1071616)"
format: pdf
editor: visual
---

#### name, ID and emails (How fo on the next line for authors? in the authors?)

Juan Gustavo Prestes Calani - 1071203 -

Elena Rocco - 1068161 - elena.rocco3\@studio.unibo.it

Chiara Baviera - 1071616 -

### Introduction

In recent years, the Brazilian politics immersed into the discussion about the so called "Centrão" (“Big Center” in Portuguese). Initially representing a group of political parties forming an informal alliance to counter the Constitution of Ulysses Guimarães, the term came to represent a group of politicians whose interest in politics only holds in supporting the executive in exchange of benefits, regardless of its principles and values.

For this reason, many have criticized politicians belonging to this group as well as the very existence of the Centrão. An influent group in this regard was the Movement Brazil Free (MBL), maintainning that the clientelist approach of Centrão perpetuates poverty in the areas where it is elected (Renan, 2024).

This paper proposes to use publicly available data to evaluate the claim of the group that as cities develop and their populations grow wealthier, voters tend to shift their electoral behavior toward "votes of opinion", that is chosing right or left wing parties rather than centrist options. As a matter of fact, the center mostly overlaps with the Centrão. Hence the research question is the following: *is economic development correlated to a decrease in centrist voting patterns, and increase in "votes of opinion"?*

The analysis will be focused on agricultural GDP, as rural areas are typically the poorest, and because of the claim by MBL that when agriculture advances in certain regions, the deriving wealth allows people to be set free from the Centrão and to develop economically as a consequence

```{r warning = FALSE, message = FALSE}

#packages needed
library(tidyverse)
library(readxl)
library(knitr)
library(kableExtra)
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(scales)
library(ggthemes)
library(broom)
library(devtools)
library(rvest)
library(ggforce)
```

#### Description of datasets

We retreived GDP data to operationalize wealth and electoral data on Brazilian governmental sites, so as to cover the whole population.

On the other hand, classifying political parties according to their orientation proved more difficult. We used two papers by political scientist referring to the same period and showing broadly comparable results for the parties in common. As for the remaining parties, we used AI to classify those who had only changed name in the same way as the predecessors. Finally, the remaining three parties were classified as Center, as they traditionally belonged to the centrão.

As for the period of reference of our analysis, we chose 2008-2020 because of the high number of mismatching municipalities from 2002 to 2020 causing half of the sample to return missing data when computing growths.

#### GDP data

We downloaded the data about GDP from the [Brazilian Institute of Geography and Statistics (IBGE) site](https://www.ibge.gov.br/estatisticas/economicas/contas-nacionais/9088-produto-interno-bruto-dos-municipios.html?=&t=resultados).Here can be found the two datasets, referring to 2002-2009 and 2010-2021.

The data was dowloaded in xls/xlsx and read. After that, we selected the variables of interest: as we aimed to assess growht in rural areas, we selected the variable "Valor adicionado bruto da Agropecuária, a preços correntes (R\$ 1.000)", that is the Gross agricultural Value, along with the municipality, state, region and year of the observation. Following that, they were merged in a single dataset (GDP_Agri), after renaming agricultural GDP as Gross_agriculture_value.

```{r}

GDP_M_complete1 <- read_excel("PIB_dos_Municípios_base_de_dados_2002_2009.xls")
GDP_M_complete2 <- read_excel("PIB_dos_Municípios_base_de_dados_2010_2021.xlsx")

#rename the variable of interest because of issue with line changes in original name
colnames(GDP_M_complete1)[33]<- "Gross_agriculture_value"
colnames(GDP_M_complete2)[33]<- "Gross_agriculture_value"

#select the variables of interest
GDP_M_complete1<-GDP_M_complete1|>
  select(Ano,`Nome do Município`,`Sigla da Unidade da Federação`,`Nome da Grande Região`,Gross_agriculture_value)

GDP_M_complete2<- GDP_M_complete2|>
  select(Ano,`Nome do Município`,`Sigla da Unidade da Federação`,`Nome da Grande Região`,Gross_agriculture_value)
  
GDP_Agri<- GDP_M_complete1|>
  full_join(GDP_M_complete2, join_by(Ano,`Nome do Município`,`Sigla da Unidade da Federação`,`Nome da Grande Região`,Gross_agriculture_value))
#use everything as a compound key to avoid issue with same-named municipalities and the creation of double columns

# select the period of interest
# rewrite municipalities in capital letters, so as to match the electoral data ones

GDP_Agri<- GDP_Agri |>
  filter( Ano >= 2008)|>
#the zeros are actually missing data
   mutate(Gross_agriculture_value = ifelse(Gross_agriculture_value == 0,NA, Gross_agriculture_value)) %>% 
  mutate(`Nome do Município`= toupper(`Nome do Município`))
```

variable description

| variable                      | type                  | description                                 |
|----------------------|------------------|--------------------------------|
| Nome do Município             | qualitative, nominal  | name of the municipality                    |
| Ano                           | numerical, discrete   | year                                        |
| Sigla da Unidade da Federação | qualitative, nominal  | Acronym of the state of the municipality    |
| Nome da Grande Região         | qualitative,nominal   | Name of the macroregion of the municipality |
| Gross_agriculture_value       | numerical, continuous | expressed in 1,000 R\$                      |

Here we provide some summary statitsics about GDP over time

```{r}

GDP_Agri|>
  filter(Ano %in% c(2008,2021))|>
  group_by(Ano)|>
  summarize( maximum = max(Gross_agriculture_value, na.rm = T),
             minimum = min(Gross_agriculture_value, na.rm = T),
             Average = mean(Gross_agriculture_value, na.rm = T),
             Median  = median(Gross_agriculture_value, na.rm = T))
```

Agricultural GDP increased almost 5-fold during the period, maintaining quite a difference between the average and the median, possibly indicating more outliers having an outstanding growht rate than mediocre ones.

Here is an overview of the trend of the GDP by state and region

```{r message = FALSE , warning = FALSE}

# calculate the total agricultural GDP by state
GDP_Agri_states<- GDP_Agri |>
  group_by(`Sigla da Unidade da Federação`, `Nome da Grande Região`, Ano)|>
  summarize(
    "State_agricultural_GDP" = sum(Gross_agriculture_value, na.rm = TRUE)) 

Palette1<-colorRampPalette(brewer.pal(27, "Set1"))(27)

ggplot( data = GDP_Agri_states, aes( y= State_agricultural_GDP/1000000, #express in blns
x = Ano, color = `Sigla da Unidade da Federação` )) + #color by state
  geom_line(linewidth= 0.5) +
  theme_minimal() +
  ylab("State Agricultural GDP (bln R$)")+
   xlab("Year")+
  scale_color_manual(name = "Region", values = Palette1) +
  scale_y_continuous(labels = label_comma(scale = 1)) + #comma separated numbers
theme(legend.position = "right") 

#colors chosen to represent Brazilian regions
Palette<- c(  "#FFD700", "#8DC63F", "#006400", "#0073A2", "#003B5C")

ggplot( data = GDP_Agri_states, aes( y= State_agricultural_GDP/1000000, 
x = Ano, 
group = `Sigla da Unidade da Federação`, #represent trend by state
color = `Nome da Grande Região`)) + #color by region
  geom_line(linewidth= 0.5) +
  theme_minimal() +
  ylab("State Agricultural GDP (bln R$)")+
   xlab("Year")+
  scale_color_manual(name = "Region", values = Palette) +
  scale_y_continuous(labels = label_comma(scale = 1)) + #comma separated numbers
theme(legend.position = "bottom") 

```

It looks like 2019 was a turning point for spurring agricultural growth in several states.

#### Electoral data

We used electoral data dowloaded in the[Supreme Electoral Court (TSE) archives](https://sig.tse.jus.br/ords/dwapr/r/seai/sig-eleicao-arquivo/conjuntos-de-dados?p10_cd_modulo=resultado&session=118004809136717&cs=1iWGX_4kCm1I9RFT7LM3g8OGvjyuhSs0dfNeA6vcgSvnZ5DWoq10rybAKreqCloli3ZA2UxYgg9qMOPODXrRUuA),reporting electoral data from 1998 to 2024. We chose to use the data coming from the section ["Votação candidato"](https://sig.tse.jus.br/ords/dwapr/r/seai/sig-eleicao-arquivo/passo-1?p20_sq_conjunto_dados=15&session=118004809136717&cs=16qyseB2rOIuaxHc8XPeS3xoeL1y26F7Srv6mSThnuasVCHOPxKLkEyIvbSqkvRUz4mubhTQWMiDimKFMFopx_Q) (Candidate ballot). First, we chose only Deputies (Deputado) and Vereadores elections, which alternate every two years. Then we filtered for the variables of interest to addition to the candidate (Nome.candidato) and date of election, that we report below. We followed this procedure to download the dataset for each year. Then, we used a for loop to read the datasets, name them, and insert them into a list, to then bind them in a single long dataset (Elections_1998_2024).

```{r eval = FALSE}

# Loop to read datasets and insert them into a list. Then concatenate them into one

#define years of the datasets for the loop
start_year <- 1998
end_year <- 2024
year_interval <- 2

# empty list to use
datasets <- list()

for (year in seq(start_year, end_year, by = year_interval)) {
  # file path
  file_path <- paste0("votacao_candidato", year, ".csv")
  # dataset name
  dataset_name <- paste0("Elections_", year)
  #if the dataset is found, name it and read it
  if (file.exists(file_path)) {
    
    dataset <- read.csv(file_path, fileEncoding = "latin1", sep = ";")
    
    assign(dataset_name, dataset)
    
    datasets[[dataset_name]] <- dataset
    
    #error to display if not found
  } else {
    message(paste("File for year", year, "does not exist:", file_path))
  }
}

# Combine all datasets using rbind
Elections_1998_2024 <- do.call(rbind, datasets)

#eliminate date
Elections_1998_2024<-Elections_1998_2024[,-9]

#categorize the variable
Elections_1998_2024$Partido<- as.factor(Elections_1998_2024$Partido)

```

Here is a description of the variables

| variable       | type                  | description           |
|----------------|-----------------------|-----------------------|
| Ano.de.eleição | numerical, discrete   | year of election      |
| Município      | qualitative, nominal  | municipality          |
| UF             | qualitative, nominal  | state                 |
| Partido        | qualitative, nominal  | party                 |
| Votos.Válidos  | numerical, continuous | number of valid votes |

#descriptive statitsics???

```{r}

Election_1998_2024|>
  group_by(Partido)|>
  summarize(sum(Votos))


```

### Attempts at defining the political spectrum of parties

Defining the political spectrum of Brazilian parties is inherently difficult and out of the scope of this paper. Hence we used two academic papers presented at these sites to scrape data from tables about the parties' classification on a continuous scale ranging from left to right. The \[first paper\]((https://www.scielo.br/j/civitas/a/XPYDSP37JSDdwv3ZrvyZL6h/) presents scores on a scale from 1 to 7, whereas the \[second one\]((https://www.scielo.br/j/dados/a/zzyM3gzHD4P45WWdytXjZWg/?format=pdf&lang=en) from 1 to 10. For this reason, we rescaled the second paper on a scale from 1 to 7 using a user-written function (rescale()). In particular, we categorized parties as belonging to left, center and right based on their position with respect to quartiles: those falling before the first were classified as left, those falling after the third as right, and all those in the middle as center. The categorization was done prior to the merging, so as not to create useless discrepancies whenever the categorization by the two papers was the same. As for the parties presenting ambiguities, we chose to classify them as center, since they all traditionally belonged to the centrão. Finally,for the classification of the remaining parties we used AI to identify the parties that had only changed names and maintained the same orientation. For those without an orientation, we asked the bot to provide an estimate of the score based on the methods of the papers. As we could not scrape the chat, as it is private, we pasted the results in an excel file. The final dataset provides for two interrelated variables: orientation and "Center", a binary variable taking on value 1 if the party belongs to the center and 0 otherwise.

Finally, we added the information about political orientation to the electoral dataset.

```{r  eval=FALSE, warning = FALSE}

# scrape first classification

Parties_spectrum<- read_html("https://www.scielo.br/j/civitas/a/XPYDSP37JSDdwv3ZrvyZL6h/")

tables <-Parties_spectrum|>
  html_elements("table")

Parties_spectrum <- tables[[2]] |> 
    html_table()|>
  select(Partido, Média)

#define orientation
Parties_spectrum <- Parties_spectrum|>
  #change separator before classifying
  mutate(Média = as.numeric(str_replace(Média,",",".")))|>
  mutate("orientation" = ifelse(Média>=5.2, "right",                  
                          ifelse(Média<3.150,"left","center")))|>
  select(-Média)

#rename as we need in upper case
Parties_spectrum[3,1]<-"PSOL"

#scrape second classification


Parties_orientation_2<- read_html("https://www.scielo.br/j/dados/a/zzyM3gzHD4P45WWdytXjZWg/?lang=en")

Parties_orientation_2<- Parties_orientation_2|>
  html_element("table")|>
  html_table()|>
  select(`Political Party`, Average)|>
  #rename for consistency with other datasets
  rename( "Partido" = `Political Party`, "Média" = Average)

#rescale second classification from 1 to 7:

#create a function for rescaling values
rescale<-function(x){
  rescaled_value<-((x - 1) / (10 - 1)) * (7 - 1) + 1
  return(round(rescaled_value,2))
}

Parties_orientation_2 <- Parties_orientation_2|> 
  #replace commas w dots and turn into numeric
  mutate(Média = as.numeric(str_replace(Média,",",".")))|>
  mutate(Média = rescale(Média)) 


Parties_orientation_2<-Parties_orientation_2|>
   mutate("orientation" = ifelse(Média>=5.2, "right",                             
                          ifelse(Média<3.150,"left","center")))|>
  select(- Média)

#change spelling to match the electoral dataset, only when needed
Parties_orientation_2$Partido<-as.character((Parties_orientation_2$Partido))
Parties_orientation_2$Partido[c(9,13,24,31,32,34)]<-toupper(Parties_orientation_2$Partido[c(9,13,24,31,32,34)])
Parties_orientation_2[5,1]<-"PC do B"
Parties_orientation_2[21,1]<-"PODE"
Parties_orientation_2$Partido<-as.factor((Parties_orientation_2$Partido))

#load the excel file with AI results
Parties_orientation_3 <-read_excel("partidos_3.xlsx")
Parties_orientation_3<-Parties_orientation_3|>
  mutate (`Média (Average)`= as.numeric(`Média (Average)`))|>
  mutate( `Média` = rescale(`Média (Average)`))|> #also rename for consistency
  select(Partido, `Média` )

Parties_orientation_3<-Parties_orientation_3|>
   mutate("orientation" = ifelse(Média>=5.2, "right",
                               ifelse(Média<3.150,"left","center")))|>
  select(-Média)


#add others, based on the feedback given by the AI and parties traditionally belonging to the centrão

Parties_orientation_3$orientation[c(1,6,8,10:13,20,21,23,24)]<-c("center","center","right","right","center","center","left","left","center","right","center")

#adjust names
#remove name of previous party into parentheses
Parties_orientation_3$Partido<-gsub("\\s*\\(.*\\)", "", Parties_orientation_3$Partido)
#use upper case only when needed
Parties_orientation_3$Partido[c(2:5,7,9,14,15,17:19,21,22,24)] <- 
  toupper(Parties_orientation_3$Partido[c(2:5,7,9,14,15,17:19,21,22,24)])

#merge 
All_parties_orientation <-Parties_spectrum|>
  full_join(Parties_orientation_2, by = c("Partido" = "Partido"))|>
  full_join(Parties_orientation_3,by = c("Partido" = "Partido"))

#define the orientation of contrasting classification
#All_parties_orientation|>
 # filter(orientation.x != orientation.y)

#since they are all traditionally from centrao, we classify them as center
All_parties_orientation[8,2]<-"center"
All_parties_orientation[19,2]<-"center"
All_parties_orientation[17,2]<-"center"

#merge the first and last column to get the full classification in one
All_parties_orientation<-All_parties_orientation|>
  mutate(orientation = ifelse( !is.na(orientation.x), orientation.x,       #if finds a value in the first keep, otherwise..
                               ifelse(!is.na(orientation.y),orientation.y, # take the second if there is, otherwise...
                                             orientation)))|>              #use the third value
           select(Partido, orientation)

# create a binary variable for purpose of analysis
All_parties_orientation<- All_parties_orientation|>
  mutate(center = ifelse( orientation == "center",1,0))

#add to the electoral dataset the party classification 
Data_Elections_1998_2024<- Elections_1998_2024|>
  left_join(All_parties_orientation, by = "Partido")

#write the csv file to load, rather than running the code
# write.csv(Data_Elections_1998_2024,"C:\\Users\\Utente\\OneDrive\\Desktop\\Big data in soc. sc.s\\report\\votos\\Data_Elections_1998_2024")

#filter for the years of interest
Data_Elections_1998_2024<- Data_Elections_1998_2024|>
  filter(Ano.de.eleição >= 2008)

```

```{r}
# read the tidy dataset with all electoral and orientation data:

Data_Elections_1998_2024<-read.csv("Data_Elections_1998_2024", fileEncoding = "UTF-8")

# filter the period of interest
Data_Elections_1998_2024<- Data_Elections_1998_2024|>
  filter(Ano.de.eleição >= 2008)|>
  select(-X)
```

Here is a breakdown of the variables included

| variable    | type                                         | description                                         |
|---------------|--------------------------|-------------------------------|
| Partido     | qualitative , nominal                        | party                                               |
| orientation | qualitative, ordinal                         | 3 levels: "left", "center","right"                  |
| Center      | qualitative, binary (expressed as numerical) | = 1 if the party belongs to the center, 0 otherwise |

### Method

For the purpose of assessing the relationship between growth in GDP and change in political opinion, the original datasets were further manipulated to create new variables

**GDP data**

We created a dataset with figures about the growth of the municipalities' agricultural GDP over the period. We used the Compound Annual Growth Rate (CAGR) as a measure for yearly growth, and named it perc_increase_agri.

Following that, we created a dataset with figures about the growth of the municipalities' agricultural GDP over the period. We used the Compound Annual Growth Rate (CAGR) as a measure for yearly growth, and named it perc_increase_agri.

```{r message = FALSE}

GDP_AGR_percentage <- GDP_Agri %>%
  
  # Replace zeros with NA, as they are missing data
  mutate(Gross_agriculture_value = ifelse(Gross_agriculture_value == 0,
                                          NA, Gross_agriculture_value)) %>%
  
  group_by(`Nome do Município`, `Sigla da Unidade da Federação`, `Nome da Grande Região`) %>% #keep region and state
  filter(!is.na(Gross_agriculture_value)) %>% # Remove rows with missing data
  
  #define start and end points 
  summarize(
    first_year = min(Ano, na.rm = TRUE),
    value_2008 = sum(Gross_agriculture_value[Ano == 2008], na.rm = TRUE),
    value_2021 = sum(Gross_agriculture_value[Ano == 2021], na.rm = TRUE)) %>%
  
  #filter out the few observations starting later than 2008, not to introduce biases
  filter(first_year <= 2008) %>% 
  
  #filter out NA and 0 values to avoid computation errors and biases
  filter(!is.na(value_2008) & !is.na(value_2021) & value_2008!= 0 & value_2021 != 0) %>% 
  
  # Calculate yearly avg percentage increase (CAGR)
  mutate(perc_increase_agri = round((((value_2021 /value_2008)^(1/12))-1) * 100, 2)) %>%
  
  #keep variables of interest
  select(`Nome do Município`,`Nome da Grande Região`,perc_increase_agri)%>%
  arrange(desc(perc_increase_agri)) # Sort by growth in descending order

#head(GDP_AGR_percentage)|>
  # mutate(perc_increase_agri = (paste0(perc_increase_agri,"%"))) |>
  #knitr::kable()|>
  #kableExtra::kable_styling(font_size = 16)

```

```{r}

data<-GDP_AGR_percentage|>
  group_by(`Nome da Grande Região`)|>
  summarize(Average = mean(perc_increase_agri, na.rm = T))|>
  arrange(desc(Average))
  
ggplot (data = data , aes (x = reorder(`Nome da Grande Região`, Average), y = Average, color = `Nome da Grande Região`))+
    geom_bar(stat = "identity", fill = Palette,  color = "black", width = 0.5)+
    coord_flip() +
    scale_y_continuous(labels = label_percent(scale = 1))+
    labs( title = "Average CARG by region",
          x = "Region",
          y = "Average CAGR from 2008 to 2020"
    ) +
    theme_minimal()
  
```

```{r}

data<-GDP_AGR_percentage|>
  group_by(`Sigla da Unidade da Federação`, `Nome da Grande Região`)|>
  summarize(Average = mean(perc_increase_agri, na.rm = T))|>
  arrange(desc(Average))
  
ggplot (data = data , aes (x = reorder(`Sigla da Unidade da Federação`, Average), y = Average, fill = `Nome da Grande Região`))+
    geom_bar(stat = "identity")+
    coord_flip() +
    scale_y_continuous(labels = label_percent(scale = 1))+
  scale_fill_manual(values = Palette)+
    labs( title = "Average CARG by state",
          x = "State",
          y = "Average CAGR from 2008 to 2020") +
    theme_minimal()+
    theme(
    axis.text.y = element_text(size = 6))

```

The breakdown by region of the CAGR indicates that Center-west and North region envisaged the highest consistent increases, as we expected, as northern regions are typically rural compared to southern ones.

**Political orientation**

Using the variables "orientation" and "center", it was possible to define the proportion of people voting to the center by municipality and year (perc_center) and to the other orientations (left, center, right), other than the change in the proportion of people voting to the center, expressed in percentage points (center_perc_points_change). All these will be used as a measure of the degree of vote-of-opinion in the municipalities, and its change through time.

In addition, we created an index defining the overall political orientation of the municipality (index), ranging from -1 in the (hypothetical) case that all people voted to the left, to +1 in case all people voted to the right. The index was computed as:

$\large Orientation \;\;index =\Large\frac{votes_{right}\;(1)\; + \; votes_{center}\;(0) \;+ \;votes_{left}\;(-1)}{votes_{total}}$

here is how we created the variable perc_center

```{r warning = FALSE}

#join the electoral dataset 
data_m_agr <- Data_Elections_1998_2024|>
  group_by(Município, Ano.de.eleição)|>
  summarize( perc_center = round((sum(Votos.válidos[Centre== 1]/sum(Votos.válidos)))*100,2))

```

Variable center_perc_points_change:

```{r}

# Dataset with change in votes to the center over the period

election_summary <- Data_Elections_1998_2024 |>
  filter(`Ano.de.eleição` %in% c(2008, 2020)) |> #choose the years of interest 
  group_by(Município,UF,`Ano.de.eleição`) |>
  reframe(Votos_válidos = sum(Votos.válidos, na.rm = TRUE), #calculate tot votes by municipality
    orientation_center = sum(Votos.válidos[orientation == "centre"], na.rm = TRUE)) #votes to the center 
    #note: used reframe instead of mutate, as suggested by an error

# Pivot the summarized election data to a wide format
election_summary <- election_summary |>
  pivot_wider(names_from = `Ano.de.eleição`,
              values_from = c(Votos_válidos, orientation_center),
               names_prefix = "Year_")

election_summary <- election_summary |>
  mutate( # Calculate the percentage change in vote share for "center" from 2008 to 2022
    center_perc_points_change = round(((orientation_center_Year_2020 / Votos_válidos_Year_2020) * 100 -
                                        (orientation_center_Year_2008 /Votos_válidos_Year_2008) * 100),2 ))

```

```{r}
data<-election_summary|>
  group_by(UF)|>
  summarize( n_municipalities = n(),
    "Percentage change of votes to the center" = sum(center_perc_points_change, na.rm = TRUE)/n_municipalities)

ggplot (data = data , aes (x = reorder(UF, `Percentage change of votes to the center`), y = `Percentage change of votes to the center`, fill = UF))+
    geom_bar(stat = "identity")+
    coord_flip() +
    scale_y_continuous(labels = label_percent(scale = 1))+
  scale_fill_viridis_d(option = "D")+
    labs( title = "Average percentage change in votes to the center by state",
          x = "State",
          y = "Average percentage change from 2008 to 2020") +
    theme_minimal()+
    theme(
    axis.text.y = element_text(size = 6))

```

Overall, the decrease in votes to the center was prominent compared to the increase.

Orientation index:

```{r warning = FALSE, message = FALSE}
#survey the whole political spectrum

data_orientation<-Data_Elections_1998_2024|>
  filter(Ano.de.eleição %in% c(2008,2020))|>
  select(Ano.de.eleição,Município, UF , orientation, Votos.válidos)|>
  group_by(Município, UF , Ano.de.eleição)|>
  summarize( "left"= round((sum(Votos.válidos[orientation =="left"])/sum(Votos.válidos))*100,2), 
             "center" = round((sum(Votos.válidos[orientation == "center"])/sum(Votos.válidos))*100,2),
             "right" = round((sum(Votos.válidos[orientation == "right"])/sum(Votos.válidos))*100,2))

# Filter the data for only 2008 and 2020
data_orientation_filtered <- data_orientation |>
  filter(Ano.de.eleição %in% c(2008, 2020))|>
  filter(n_distinct(Ano.de.eleição) == 2)  

# Calculate the index for both years and reshape the data

data_orientation_calculated <- data_orientation_filtered |>
  group_by(Município, UF) |>
  summarize(index_2008 = sum(case_when(
             Ano.de.eleição == 2008 ~ (right/100) * 1 + (center/100) * 0 + (left/100) * -1,
             TRUE ~ 0 )),
            index_2020 = sum(case_when(
            Ano.de.eleição == 2020 ~ (right/100) * 1 + (center/100) * 0 + (left/100)  * -1,
            TRUE ~ 0 )),
            .groups = "drop") |>
  mutate(orientation_change = round((index_2020 - index_2008),2))

```

```{r}

data<-data_orientation_calculated|>
  group_by(UF)|>
  summarize( n_municipalities = n(),
    "Average change in orientation index" = sum(orientation_change, na.rm = TRUE)/n_municipalities)


ggplot (data = data , aes (x = reorder(UF, `Average change in orientation index`), y =  `Average change in orientation index`, fill = UF))+
    geom_bar(stat = "identity")+
    coord_flip() +
    scale_y_continuous(labels = label_percent(scale = 1))+
  scale_fill_viridis_d(option = "D")+
    labs( title = "Average change in orientation index by state",
          x = "State",
          y = "Average change in orientation index from 2008 to 2020") +
    theme_minimal()+
    theme(
    axis.text.y = element_text(size = 6))


```

This graph provides a highly relevant insight: overall, across all Brazil the tendency to vote to the right increased.

Here are the new variables created\>

| variable                  | type                  | description                                                                            |
|---------------|---------------|------------------------------------------|
| perc_increase_agri        | numerical, continuous | Yearly increase (CAGR) in agriculture GDP from 2008 to 2020 (in percentage points)     |
| center_perc_points_change | numerical, continuous | change (in percentage points) in the proportion of the population voting to the center |
| left                      | numerical, continuous | proportion of people voting for the left (in percentage points)                        |
| center                    | numerical, continuous | proportion of people voting for the center (in percentage points)                      |
| right                     | numerical, continuous | proportion of people voting for the right (in percentage points)                       |
| orientation_change        | numerical, continuous | proportion of people voting for the right (in percentage points)                       |

### Data Analysis and results

The analysis we carried out is of descriptive character and has the purpose of finding patterns between changes in economic conditions and political orientation in Brazil. The analysis spans three levels of specificity. First, we gave a general picture of the phenomenon relating GDP and votes to the center rather than their changes over time. Following that, we analysed single municipalities having an outstanding growth in GDP as a means of example. Finally, we represented changes in political opinion and economic development of the sample of municipalities over the period, being the prime object of interest.

#### Broader GDP and political opinion trends

Below is a graph relating the percentage of people voting to the center and GDP per municipality at all points in time (2008 to 2020).

```{r  message = FALSE, warning = FALSE, message = FALSE}

#join the electoral dataset 
data<-data_m_agr |>
 inner_join(GDP_Agri, by = c("Município" = "Nome do Município" , "Ano.de.eleição"= "Ano"))
 
ggplot(data = data , aes(x = Gross_agriculture_value/1000, y = perc_center, color = `Nome da Grande Região`)) +
  geom_point(na.rm = TRUE, alpha = 0.7, shape = 4, size = 0.5) +  
  geom_smooth(method = "lm", se = FALSE, color = "#00008B", linewidth = 0.5) +
  theme_minimal() +
  scale_color_manual( name = "Region", values = Palette) +  # Use custom colors+
   scale_x_continuous(limits = c(0,1500), labels = label_number(scale = 1))+
  scale_y_continuous(labels = label_percent(scale = 1)) + # add percent
  xlab('Agricultural GDP (in bln R$)') +
  ylab('Votes to the center(%)') +
  ggtitle('Agricultural GDP and percentage of votes to the center') +
  theme(legend.position = "bottom")

```

From the data emerges that there is no correlation between agricultural and industrial GDP and political opinion to the center, meaning that we cannot directly infer the degree of votes to the center knowing the two GDPs of a municipality.

#### Selected cases

Below is a plot of the trend of GDP in the municipalities that envisaged the highest growth rates.

```{r}

# select the 10 municipalities with higher increase for later analysis
GDP_AGR_percentage2<-GDP_AGR_percentage|>
   arrange(desc(perc_increase_agri))|>
  head(9)

#plot of best municipalities over the whole period
municipios2<-c( GDP_AGR_percentage2$`Nome do Município`)

data2<- GDP_Agri|>
  filter(`Nome do Município` %in% municipios2 )|>
  mutate(`Nome do Município` = factor(`Nome do Município`, levels = municipios2))

ggplot( data = data2, aes(x = Ano, y = Gross_agriculture_value, color = `Nome da Grande Região` ))+
  geom_line() + 
  facet_wrap_paginate(~ `Nome do Município`, scales = "free_y", ncol = 3) +
   theme_minimal() +
    scale_y_continuous(labels = scales::label_comma()) +
  scale_x_continuous(breaks = seq(min(data2$Ano), max(data2$Ano), by = 4)) +
  scale_color_manual( name = "Region", values = c("#8DC63F", "#0073A2", "#006400"))+
  # each plot is scaled according to the values of the municipality
  theme(legend.position = "bottom",
        legend.title = element_text(size = 10),
    legend.text = element_text(size = 8),
    axis.text.x = element_text(size = , angle = 45, hjust = 1),  # rotated x-axis labels
    axis.title = element_text(size = 10),
    strip.text = element_text(size = 8)  #name of municipalities size
  ) +
  labs(title = "Agricultural GDP",
    x = "Year",
    y = "Gross Agriculture Value (R$ 1,000)",
    color = "Region", # Legend title
  )
    
```

The trend of the best-performing municipalities confirms the broader state-level patterns.

Now we explore how political orientation changed in terms of support to the three political orientations in the municipalities above. For this purpose, we used the variables left, center and right, representing proportions over the total.

```{r message = FALSE, warning = FALSE}

# Extract the municipalities from GDP_AGR_percentage2
municipios2 <- GDP_AGR_percentage2$`Nome do Município`

# Filter the election data
data <- Data_Elections_1998_2024 %>%
  filter(Município %in% municipios2, Ano.de.eleição %in% c(2008, 2020)) %>%
  select(Ano.de.eleição, Município, orientation, Votos.válidos) %>%
  mutate(Município = factor(Município, levels = municipios2))

# Aggregate votes by orientation and calculate percentages
municipality_orientation_agr <- data %>%
  group_by(Município, Ano.de.eleição) %>%
  rename("Municipality" = Município, "Year" = Ano.de.eleição) %>%
  summarize(
    left = round((sum(Votos.válidos[orientation == "left"]) / sum(Votos.válidos)) * 100, 2),
    center = round((sum(Votos.válidos[orientation == "centre"]) / sum(Votos.válidos)) * 100, 2),
    right = round((sum(Votos.válidos[orientation == "right"]) / sum(Votos.válidos)) * 100, 2),
    .groups = "drop")

# Add the growth rate from GDP_AGR_percentage2
municipality_orientation_agr <- municipality_orientation_agr %>%
  left_join(
    GDP_AGR_percentage2 %>% select(`Nome do Município`, perc_increase_agri),
    by = c("Municipality" = "Nome do Município"))

#table to display:

# Pivot data to get 2008 and 2020 values side by side
formatted_table_wide <- municipality_orientation_agr %>%
  pivot_wider(names_from = Year, values_from = c(left, center, right))

# Calculate the differences between 2020 and 2008 for each orientation
formatted_table_wide <- formatted_table_wide %>%
  mutate( left_diff = `left_2020` - `left_2008`,
           center_diff = `center_2020` - `center_2008`,
           right_diff = `right_2020` - `right_2008`)

left_colors <- ifelse(
  formatted_table_wide$left_diff > 20, "#90EE90",  # Strong green for >20%
  ifelse(formatted_table_wide$left_diff > 5 & formatted_table_wide$left_diff <= 20, "#D9F2D1",  # Light green for 5-20%
    ifelse(formatted_table_wide$left_diff < -20, "#F08080",  # Strong red for <-20%
      ifelse(formatted_table_wide$left_diff < -5 & formatted_table_wide$left_diff >= -20, "#F9D5D3",  # Light red for -20% to -5%
        "#FFFCE8" )))) # White for -5% to 5%

center_colors <- ifelse(
  formatted_table_wide$center_diff > 20, "#90EE90",
  ifelse(formatted_table_wide$center_diff > 5 & formatted_table_wide$center_diff <= 20, "#D9F2D1",
  ifelse(formatted_table_wide$center_diff < -20, "#F08080",
  ifelse(formatted_table_wide$center_diff < -5 & formatted_table_wide$center_diff >= -20, "#F9D5D3",
  "#FFFCE8"))))

right_colors <- ifelse(
  formatted_table_wide$right_diff > 20, "#90EE90",
  ifelse(formatted_table_wide$right_diff > 5 & formatted_table_wide$right_diff <= 20, "#D9F2D1",
  ifelse(formatted_table_wide$right_diff < -20, "#F08080",
  ifelse(formatted_table_wide$right_diff < -5 & formatted_table_wide$right_diff >= -20, "#F9D5D3",
        "#FFFCE8"))))


# Create a styled table 
table1<-formatted_table_wide %>%
  rename( `yearly increase` = perc_increase_agri)%>%
  head(12)%>%
  select(-left_diff, -center_diff, -right_diff) %>%  # Exclude the diff columns
  kable() %>%
  kable_styling(
    font_size = 10,
    bootstrap_options = c("striped", "hover", "condensed", "responsive")
  ) %>%
  # Apply gradient color to the left, center, and right columns based on the diff (increase or decrease)
  column_spec(4, background = left_colors) %>%
  column_spec(6, background = center_colors) %>%
  column_spec(8, background = right_colors)

table1

```

Overall, in most of the municipalities support to the left decreased. However, the pattern regarding vote to the center is not so clear.

#### Municipality-level analysis

In order to assess the change in political opinion compared to economic development, we regressed change in votes to the center on the cumulative average growth rate of GDP (yearly increase).

```{r warning = FALSE, message = FALSE}

# Join the dataset on change in votes to the center with GDP_AGR_percentage
data_m_agr2<- election_summary |>
  inner_join(GDP_AGR_percentage, by = c("Município" = "Nome do Município"))


ggplot(data = data_m_agr2, aes(x = perc_increase_agri, y = center_perc_points_change, color = `Nome da Grande Região`)) +
  geom_point(size = 1, alpha = 0.5, shape = 17) +  # transparency 
  geom_smooth(method="lm", color = "#00008B", linewidth =0.5) +
  scale_color_manual( values = Palette, name = "Region") +
  theme_base() +
    xlim (0,40)+ #we excluude outliers from visualization
  theme(
        plot.title = element_text(size = 12),
         axis.title.x = element_text(size = 10),
    axis.title.y = element_text(size = 10),
            axis.text.x = element_text(size = 8),
        axis.text.y = element_text(size = 8),)+
  labs(x = "Yearly % Increase in Agricultural GDP",y = "% point change of votes to the center" )


```

```{r warning = FALSE}

#regression

mod1 <- lm(center_perc_points_change ~ perc_increase_agri, data = data_m_agr2)

tidy(mod1)%>%
  mutate(across(where(is.numeric), ~ round(.,3))) |>
  bind_rows(tibble(term = "R-squared", estimate = glance(mod1)$r.squared) %>%
  mutate(across(where(is.numeric), ~ round(., 3))))

```

The regression suggests that municipalities having a higher GDP growth have a slightly higher tendency to have increased their votes to the center. However, the relationship is almost null and not statistically significant.

However, no change in support to the center does not mean there was no change in the orientation supported at all. For this reason, we regressed the change in GDP on the change in orientation index:

```{r warning = FALSE, message = FALSE}

#join with dataset on orientation index
data_or_agr<- GDP_AGR_percentage|>
  inner_join(data_orientation_calculated, by = c("Nome do Município" = "Município"))|>
  mutate(perc_increase_agri = round(perc_increase_agri,2))

ggplot(data = data_or_agr, aes(y = orientation_change, x = perc_increase_agri, color = orientation_change)) +
  geom_point(size = 1.5, alpha = 0.7) +
  geom_smooth(method = "lm", color = "#FF0000", linewidth = 0.5) +
  scale_color_gradient2(low = "#FF0000", mid = "#FFEC8B", high = "#0000FF", midpoint = 0) +
  geom_hline(yintercept = 0, linetype = "solid", color = "#000000", size = 0.3) +
  xlab("Yearly Agricultural GDP Growth")+
  theme_bw() +
  labs(title = "Yearly Agricultural Growth")+
   theme( axis.title.x = element_text(size = 9))

```

```{r warning = FALSE}

mod2 <- lm(orientation_change ~ perc_increase_agri, data = data_or_agr)

tidy(mod2)%>%
 mutate(across(where(is.numeric), ~ round(.,3))) |>
 bind_rows(tibble(term = "R-squared", estimate = glance(mod2)$r.squared) %>%
 mutate(across(where(is.numeric), ~ round(., 3))))

```

The relationship, again, is not statitsically significant, that is we cannot infer certainly whether higher GDP growth is related to a specific shift in political opinion. However we notice an interesting pattern that had already emerged in the initial descriptive statistics: Overall, there is a tendency to vote more to the right, be it more or less starkly depending on the GDP increase.

### Conclusion

In conclusion, our findings could not support the claim that agricultural economic development is related to a decreasing support to the center. Both the relationship between GDP and votes to the center and that of their change over time was found to be almost null. A pattern we observed is an increase in the support to the right, though it was not correlated to the increase in agricultural GDP.

We acknowledge the shortcomings of our regression models, which would greatly benefit from the use of controls. In addition, the timeframe considered might have influenced the estimates. Indeed, Jair Bolsonaro – here classified as pertaining to the right-wing – won the elections in 2018, just two years prior 2020, which might explain why the Brazilian political opinion appears to have shifted rightwards.
